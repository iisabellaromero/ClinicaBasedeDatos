{% extends 'index.html' %}

{% block main %}
<div class="container7">
  <h2>Resultados de búsqueda para {{ resultados[0][6] }}</h2>
  <h3>En la fecha {{ resultados[0][3] }} {{ date }}</h3>
  <table>
    <form action="/confirmacion-cita" method="post">
        <div class="container">
          <select name="doctor" id="select2">
            <option value="">Selecciona el horario de tu preferencia</option>
            {% for resultado in resultados %}
            <option value="{{ loop.index }}">{{ resultado[2] }} {{ resultado[1] }}, {{ resultado[0] }} - {{ resultado[6] }}  -   {{ resultado[4] }}</option>
            {% endfor %}
          </select>
        </div>
      </form> 
      <div class="input-container7">
        <input type="text" name="nombre" placeholder="Ingresa tu nombre">
        <input type="text" name="apellido" placeholder="Ingresa tu apellido">
        <input type="text" name="apellido2" placeholder="Ingresa tu segundo apellido">
        <input type="text" name="dni" placeholder="Ingresa tu DNI">
        <input type="date" name="nacimiento" placeholder="Ingresa tu fecha de nacimiento">
        <input type="email" name="email" placeholder="Ingresa tu email">
        <input type="text" name="telefono" placeholder="Ingresa tu teléfono">
      </div>
      <div class="container3">
        <button type="submit" class="btn" id="btn">Confirmar cita</button>
      </div>
    </table>
</div>

<script>
  let error = 0;
function validarFormulario() {
  var dni = document.forms["formulario"]["dni"].value;
  var telefono = document.forms["formulario"]["telefono"].value;
  var email = document.forms["formulario"]["email"].value;
  var nacimiento = document.forms["formulario"]["nacimiento"].value;
  var nombre = document.forms["formulario"]["nombre"].value;
  var apellido = document.forms["formulario"]["apellido"].value;
  var apellido2 = document.forms["formulario"]["apellido2"].value;
  var select = document.forms["formulario"]["select2"].value;

  if (dni.length != 8) {
    alert("El DNI debe tener 8 dígitos");
    error +=1;
    return false;
  }
  if (telefono.length != 9) {
    alert("El teléfono debe tener 9 dígitos");
    error +=1;
    return false;
  }
  if (telefono.charAt(0) != 9) {
    alert("El teléfono debe empezar por 9");
    error +=1;
    return false;
  }
  if (email.indexOf("@") == -1) {
    alert("Ingrese un mail valido");
    return false;
  }
  if (nacimiento > Date.now()) {
    alert("La fecha de nacimiento debe ser menor a la actual");
    error +=1;
    return false;
  }
  if (nombre == "") {
    alert("El nombre no puede estar vacío");
    error +=1;
    return false;
  }
  if (apellido == "") {
    alert("El apellido no puede estar vacío");
    error +=1;
    return false;
  }
  if (apellido2 == "") {
    alert("El segundo apellido no puede estar vacío");
    error +=1;
    return false;
  }
  if (select == "") {
    alert("Debes seleccionar un horario");
    error +=1;
    return false;
  }
}

// Cuando apretes el botón de confirmar cita, se ejecutará la función validarFormulario
document.getElementById("btn").addEventListener("click", validarFormulario);
if (error < 0) {
  alert("Su cita ha sido confirmada");
}


</script>

{% endblock %}
